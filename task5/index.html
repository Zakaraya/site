<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div>
    <div>
        <img src="https://en.js.cx/clipart/soccer-gate.svg" id="gate" class="droppable">
    </div>
    <div>
        <div></div>
    </div>
</div>
<div>
    <img src="https://en.js.cx/clipart/ball.svg" id="ball" class="droppable">
    <!--  <img src="images/lion.png" id="ball" class="droppable">-->
</div>


<script>
    let currentDroppable = null;
    ball = document.getElementById('ball')
    ball.onmousedown = function (event) {

        let shiftX = event.clientX - ball.getBoundingClientRect().left;
        let shiftY = event.clientY - ball.getBoundingClientRect().top;

        ball.style.position = 'absolute';
        ball.style.zIndex = 1000;
        document.body.append(ball);
        moveAt(event.pageX, event.pageY);
        function moveAt(pageX, pageY) {
            ball.style.left = pageX - shiftX + 'px';
            ball.style.top = pageY - shiftY + 'px';
        }

        function onMouseMove(event) {
            moveAt(event.pageX, event.pageY);

            ball.hidden = true;
            let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
            ball.hidden = false;

            if (!elemBelow) return;

            let droppableBelow = elemBelow.closest('.droppable');
            if (currentDroppable != droppableBelow) {
                if (currentDroppable) { // null если мы были не над droppable до этого события
                    // (например, над пустым пространством)
                    leaveDroppable(currentDroppable);
                }
                currentDroppable = droppableBelow;
                if (currentDroppable) { // null если мы не над droppable сейчас, во время этого события
                    // (например, только что покинули droppable)
                    enterDroppable(currentDroppable);
                }
            }
        }

        document.addEventListener('mousemove', onMouseMove);

        ball.onmouseup = function () {
            document.removeEventListener('mousemove', onMouseMove);
            ball.onmouseup = null;
        };

    };

    gate.onmousedown = function (event) {

        let shiftX = event.clientX - gate.getBoundingClientRect().left;
        let shiftY = event.clientY - gate.getBoundingClientRect().top;

        gate.style.position = 'absolute';
        gate.style.zIndex = 1000;
        document.body.append(gate);

        moveAt(event.pageX, event.pageY);

        function moveAt(pageX, pageY) {
            gate.style.left = pageX - shiftX + 'px';
            gate.style.top = pageY - shiftY + 'px';
        }

        function onMouseMove(event) {
            moveAt(event.pageX, event.pageY);

            gate.hidden = true;
            let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
            gate.hidden = false;

            if (!elemBelow) return;

            let droppableBelow = elemBelow.closest('.droppable');
            if (currentDroppable != droppableBelow) {
                if (currentDroppable) { // null если мы были не над droppable до этого события
                    // (например, над пустым пространством)
                    leaveDroppable(currentDroppable);
                }
                currentDroppable = droppableBelow;
                if (currentDroppable) { // null если мы не над droppable сейчас, во время этого события
                    // (например, только что покинули droppable)
                    enterDroppable(currentDroppable);
                }
            }
        }

        document.addEventListener('mousemove', onMouseMove);

        gate.onmouseup = function () {
            document.removeEventListener('mousemove', onMouseMove);
            gate.onmouseup = null;
        };

    };

    // gate.onmousedown = function(event) { // (1) отследить нажатие
    //
    //   // (2) подготовить к перемещению:
    //   // разместить поверх остального содержимого и в абсолютных координатах
    //   gate.style.position = 'absolute';
    //   gate.style.zIndex = 1000;
    //   // переместим в body, чтобы мяч был точно не внутри position:relative
    //   document.body.append(gate);
    //   // и установим абсолютно спозиционированный мяч под курсор
    //
    //   moveAt(event.pageX, event.pageY);
    //
    //   // передвинуть мяч под координаты курсора
    //   // и сдвинуть на половину ширины/высоты для центрирования
    //   function moveAt(pageX, pageY) {
    //     gate.style.left = pageX - gate.offsetWidth / 2 + 'px';
    //     gate.style.top = pageY - gate.offsetHeight / 2 + 'px';
    //   }
    //
    //   function onMouseMove(event) {
    //     moveAt(event.pageX, event.pageY);
    //   }
    //
    //   // (3) перемещать по экрану
    //   document.addEventListener('mousemove', onMouseMove);
    //
    //   // (4) положить мяч, удалить более ненужные обработчики событий
    //   gate.onmouseup = function() {
    //     document.removeEventListener('mousemove', onMouseMove);
    //     gate.onmouseup = null;
    //   };
    //
    // };
    gate.ondragstart = function () {
        return false;
    };

    let count = 0;
    function enterDroppable(elem) {
        elem.style.background = 'pink';
        count++;
        // if (count==2){
        //     alert('Finish')
        // }
    }

    function leaveDroppable(elem) {
        elem.style.background = '';
    }

    ball.ondragstart = function () {
        return false;
    };


    // collect all the divs
    var divs = document.getElementsByTagName('div');
    // get window width and height
    var winWidth = window.innerWidth - 50;
    var winHeight = window.innerHeight - 50;

    // i stands for "index". you could also call this banana or haircut. it's a variable
    for (var i = 0; i < divs.length; i++) {

        // shortcut! the current div in the list
        var thisDiv = divs[i];

        // get random numbers for each element
        randomTop = getRandomNumber(0, winHeight);
        randomLeft = getRandomNumber(0, winWidth);

        // update top and left position
        thisDiv.style.top = randomTop + "px";
        thisDiv.style.left = randomLeft + "px";

    }

    // function that returns a random number between a min and max
    function getRandomNumber(min, max) {

        return Math.random() * (max - min) + min;

    }

</script>
</body>
</html>